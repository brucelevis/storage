> 本文档对永恒魔法技术测试进行技术风险性评估

## 风险
### 服务器
#### 负载不够
改成多服后，除了用机器人测试过大规模玩家，还未经过海量玩家实测，最有可能出现的情况是多服分布不均，导致个别服务器负载特别大。

> 解决办法：准备更多的服务器，野外多线地图增加线路条数，减少单个CSubWorld实体玩家人数，引导更多的副本玩法，分流压力到战场服务器，完善各种性能参数实时查看和预警机制

#### 带宽不足
玩家聚集后，带宽压力陡增

> 解决办法：准备充足的带宽资源，持续优化带宽消耗，策划玩法引导防止大规模长时间玩家聚集，比如多使用副本。

#### 数据库异常
目前只用robot模拟测试过单数据库15~20k同时在线

> 解决办法：优化mysql配置，离散化数据存储，降低存储频率，存储间隔时间做到可以动态热更新调整

#### 程序崩溃
 1. 遍历容器过程中对容器进行修改，修改包括insert，erase等操作，现在已经改了大部分相关写法。比如listSpeStatus，在遍历中breakspe会执行一些事件或者流程图
 2. 事件或者流程图死循环
 3. 野指针，空指针
 4. 内存泄露

> 解决办法：其中1,2治本的解决方案就是使用命令队列方式，如增加状态，删减状态，触发事件，触发流程图使用命令队列的方式，所有操作在队列中排队以此执行，现阶段这样修改风险较大。1的治标就是使用容器的副本进行遍历，或者采用记录并且延后操作的方式，2的治标就是在需要的地方加标志位防止死循环重入。3,4只能靠更多更完善，覆盖面更广的测试以及代码检查。

#### 登录异常

 1. passport承载不够或者崩溃
 2. 排队，现在策略是一个游戏世界允许2500人排队，超过则直接拒绝服务并给出提示

> 解决方法：新增passport，守护进程重启，充分测试和代码检查

### 客户端

 1. 更新异常
 2. 获取列表异常
 3. 程序崩溃

> 解决方法：完善崩溃日志收集，完善游戏日志上传机制

## 热更新
当出现玩法异常后，目前可以热更新的部分包括以下

 

- 游戏道具
 - 游戏技能
 - 怪物
 - 天兽
 - 触发器
 - 状态
 - 区域
 - 地图
 - 游戏公式
 - 任务
 - 状态流程图
 - 绝大多数的PublicData
 - 补偿流程图
 - lua脚本